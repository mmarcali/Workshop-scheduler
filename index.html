<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workshop Scheduler</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .icon { width: 1rem; height: 1rem; display: inline-block; }
        .icon-lg { width: 1.5rem; height: 1.5rem; }
        .icon-xl { width: 2rem; height: 2rem; }
        .icon-2xl { width: 4rem; height: 4rem; }
        .icon-3xl { width: 5rem; height: 5rem; }
        
        .calendar-cell {
            min-height: 3rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar-cell:hover {
            transform: scale(1.02);
        }
        
        .date-in-range {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        
        .date-selected-by-participants {
            background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Google Apps Script Configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxVUTZA03Ct-MPVtf2BN-j7KC86xc295YXVSAgtDETXropngEQBCBbXDeDTB4uXDUFa9w/exec';

        // Icon components
        const Calendar = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const ChevronLeft = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="15,18 9,12 15,6"></polyline>
            </svg>
        );

        const ChevronRight = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="9,18 15,12 9,6"></polyline>
            </svg>
        );

        const Users = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        );

        const Plus = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="3,6 5,6 21,6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const CheckCircle = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22,4 12,14.01 9,11.01"></polyline>
            </svg>
        );

        const User = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );

        const Settings = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        );

        const Link = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
            </svg>
        );

        const Save = ({ className = "icon" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                <polyline points="17,21 17,13 7,13 7,21"></polyline>
                <polyline points="7,3 7,8 15,8"></polyline>
            </svg>
        );

        // Google Sheets API functions
        const saveToSheets = async (data) => {
            try {
                console.log('Attempting to save to Google Sheets:', data);
                const formData = new FormData();
                formData.append('data', JSON.stringify(data));
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }

                const result = await response.json();
                console.log('Success result:', result);
                return result;
            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
                alert(`Error saving data: ${error.message}. Check the browser console for details.`);
                throw error;
            }
        };

        const loadFromSheets = async () => {
            try {
                console.log('Loading data from Google Sheets...');
                const response = await fetch(GOOGLE_SCRIPT_URL);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                
                const result = await response.json();
                console.log('Load success result:', result);
                return result;
            } catch (error) {
                console.error('Error loading from Google Sheets:', error);
                alert(`Error loading data: ${error.message}. Using local data only.`);
                return { config: { description: '', dateRanges: [] }, participants: {} };
            }
        };

        // Calendar helper functions
        const formatDateKey = (date) => {
            return date.toISOString().split('T')[0];
        };

        const formatDateDisplay = (date) => {
            const options = { month: 'short', day: 'numeric', weekday: 'short' };
            return date.toLocaleDateString('en-US', options);
        };

        const generateCalendarWeeks = (year, month) => {
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            const endDate = new Date(lastDay);
            
            // Adjust start to beginning of week (Sunday)
            startDate.setDate(startDate.getDate() - startDate.getDay());
            
            // Adjust end to end of week (Saturday)
            endDate.setDate(endDate.getDate() + (6 - endDate.getDay()));
            
            const weeks = [];
            const currentDate = new Date(startDate);
            
            while (currentDate <= endDate) {
                const week = [];
                for (let i = 0; i < 7; i++) {
                    week.push(new Date(currentDate));
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                weeks.push(week);
            }
            
            return weeks;
        };

        const isDateInRange = (date, ranges) => {
            const dateStr = formatDateKey(date);
            return ranges.some(range => {
                const startStr = range.startDate;
                const endStr = range.endDate;
                return dateStr >= startStr && dateStr <= endStr;
            });
        };

        const isDateInCurrentMonth = (date, displayMonth) => {
            return date.getMonth() === displayMonth.getMonth() && 
                   date.getFullYear() === displayMonth.getFullYear();
        };

        // Calendar Component
        const CalendarComponent = ({ 
            dateRanges, 
            onDateClick, 
            isAdmin, 
            participants,
            selectionStart,
            highlightedRange
        }) => {
            const [displayMonth, setDisplayMonth] = useState(new Date());
            
            const weeks = generateCalendarWeeks(displayMonth.getFullYear(), displayMonth.getMonth());
            
            const navigateMonth = (direction) => {
                const newMonth = new Date(displayMonth);
                newMonth.setMonth(newMonth.getMonth() + direction);
                setDisplayMonth(newMonth);
            };

            const getDateParticipantCount = (date) => {
                const dateKey = formatDateKey(date);
                return Object.values(participants).filter(availability => 
                    availability.includes(dateKey)
                ).length;
            };

            const getDayClasses = (date) => {
                const isCurrentMonth = isDateInCurrentMonth(date, displayMonth);
                const isInRange = isDateInRange(date, dateRanges);
                const isSelectionStart = selectionStart && formatDateKey(date) === formatDateKey(selectionStart);
                const isInHighlightedRange = highlightedRange && 
                    formatDateKey(date) >= formatDateKey(highlightedRange.start) && 
                    formatDateKey(date) <= formatDateKey(highlightedRange.end);
                const participantCount = getDateParticipantCount(date);
                const hasParticipants = participantCount > 0;

                let classes = 'calendar-cell border border-gray-200 p-2 text-center ';
                
                if (!isCurrentMonth) {
                    classes += 'text-gray-300 ';
                }
                
                if (isAdmin) {
                    if (isInRange) {
                        if (hasParticipants) {
                            classes += 'date-selected-by-participants border-green-400 ';
                        } else {
                            classes += 'date-in-range border-blue-400 ';
                        }
                    }
                    
                    if (isSelectionStart) {
                        classes += 'bg-blue-500 text-white ';
                    }
                    
                    if (isInHighlightedRange && !isSelectionStart) {
                        classes += 'bg-blue-200 ';
                    }
                } else {
                    // Participant view
                    if (isInRange) {
                        const isSelected = Object.values(participants).some(availability => 
                            availability.includes(formatDateKey(date))
                        );
                        
                        if (isSelected) {
                            classes += 'bg-green-100 border-green-400 ';
                        } else {
                            classes += 'bg-blue-50 border-blue-300 hover:bg-blue-100 ';
                        }
                    } else {
                        classes += 'cursor-not-allowed opacity-50 ';
                    }
                }
                
                return classes;
            };

            return (
                <div className="bg-white border border-gray-200 rounded-lg p-4">
                    <div className="flex items-center justify-between mb-4">
                        <button
                            onClick={() => navigateMonth(-1)}
                            className="p-2 hover:bg-gray-100 rounded"
                        >
                            <ChevronLeft className="icon" />
                        </button>
                        
                        <h3 className="text-lg font-semibold">
                            {displayMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}
                        </h3>
                        
                        <button
                            onClick={() => navigateMonth(1)}
                            className="p-2 hover:bg-gray-100 rounded"
                        >
                            <ChevronRight className="icon" />
                        </button>
                    </div>
                    
                    <div className="grid grid-cols-7 gap-1">
                        {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (
                            <div key={day} className="p-2 text-center font-medium text-gray-600 text-sm">
                                {day}
                            </div>
                        ))}
                        
                        {weeks.flat().map((date, index) => {
                            const participantCount = getDateParticipantCount(date);
                            
                            return (
                                <div
                                    key={index}
                                    className={getDayClasses(date)}
                                    onClick={() => onDateClick(date)}
                                >
                                    <div className="text-sm font-medium">
                                        {formatDateDisplay(date)}
                                    </div>
                                    {isAdmin && participantCount > 0 && (
                                        <div className="text-xs text-green-600 font-medium mt-1">
                                            {participantCount} vote{participantCount !== 1 ? 's' : ''}
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const WorkshopScheduler = () => {
            const [currentView, setCurrentView] = useState('admin');
            const [participantName, setParticipantName] = useState('');
            const [dateRanges, setDateRanges] = useState([]);
            const [participants, setParticipants] = useState({});
            const [workshopDescription, setWorkshopDescription] = useState('');
            const [selectionStart, setSelectionStart] = useState(null);
            const [highlightedRange, setHighlightedRange] = useState(null);
            const [saving, setSaving] = useState(false);
            const [loading, setLoading] = useState(true);
            const [showConfirmation, setShowConfirmation] = useState(false);
            const [resultsData, setResultsData] = useState({ dateRanges: [], participants: {} });

            // Load data on component mount
            useEffect(() => {
                const loadData = async () => {
                    setLoading(true);
                    try {
                        const data = await loadFromSheets();
                        setWorkshopDescription(data.config.description || '');
                        setDateRanges(data.config.dateRanges || []);
                        setParticipants(data.participants || {});
                    } catch (error) {
                        console.error('Failed to load data:', error);
                    } finally {
                        setLoading(false);
                    }
                };
                
                loadData();
            }, []);

            // Handle URL-based navigation
            useEffect(() => {
                const checkHash = () => {
                    const hash = window.location.hash.substring(1);
                    if (hash === 'participant') {
                        setCurrentView('participant');
                    } else if (hash === 'thank-you') {
                        setCurrentView('thank-you');
                    } else {
                        setCurrentView('admin');
                    }
                };
                
                checkHash();
                window.addEventListener('hashchange', checkHash);
                return () => window.removeEventListener('hashchange', checkHash);
            }, []);

            const switchToView = (view) => {
                if (view === 'participant') {
                    window.location.hash = 'participant';
                } else if (view === 'thank-you') {
                    window.location.hash = 'thank-you';
                } else {
                    window.location.hash = '';
                }
                setCurrentView(view);
            };

            const copyParticipantLink = () => {
                const participantUrl = `${window.location.origin}${window.location.pathname}#participant`;
                navigator.clipboard.writeText(participantUrl);
                alert('Participant link copied to clipboard!');
            };

            const saveWorkshopConfig = async (updatedRanges = dateRanges) => {
                const config = {
                    type: 'config',
                    description: workshopDescription,
                    dateRanges: updatedRanges
                };
                
                await saveToSheets(config);
            };

            const handleAdminDateClick = async (date) => {
                if (!selectionStart) {
                    // First click - set start date
                    setSelectionStart(date);
                    setHighlightedRange({ start: date, end: date });
                } else {
                    // Second click - complete range selection
                    const startDate = new Date(Math.min(selectionStart, date));
                    const endDate = new Date(Math.max(selectionStart, date));
                    
                    const newRange = {
                        id: Date.now(),
                        startDate: formatDateKey(startDate),
                        endDate: formatDateKey(endDate),
                        description: workshopDescription
                    };
                    
                    const updatedRanges = [...dateRanges, newRange];
                    setDateRanges(updatedRanges);
                    setSelectionStart(null);
                    setHighlightedRange(null);
                    
                    // Save to Google Sheets and show confirmation
                    try {
                        await saveWorkshopConfig(updatedRanges);
                        setShowConfirmation(true);
                        setTimeout(() => setShowConfirmation(false), 3000);
                    } catch (error) {
                        console.error('Error saving workshop config:', error);
                    }
                }
            };

            const handleParticipantDateClick = (date) => {
                if (!participantName) return;
                
                const dateKey = formatDateKey(date);
                const isInAdminRange = isDateInRange(date, dateRanges);
                
                if (!isInAdminRange) return;
                
                const currentAvailability = participants[participantName] || [];
                let updatedAvailability;
                
                if (currentAvailability.includes(dateKey)) {
                    updatedAvailability = currentAvailability.filter(d => d !== dateKey);
                } else {
                    updatedAvailability = [...currentAvailability, dateKey];
                }
                
                setParticipants({
                    ...participants,
                    [participantName]: updatedAvailability
                });
            };

            const removeRange = async (rangeId) => {
                const updatedRanges = dateRanges.filter(range => range.id !== rangeId);
                setDateRanges(updatedRanges);
                
                // Remove participant selections for dates in this range
                const rangeToRemove = dateRanges.find(range => range.id === rangeId);
                if (rangeToRemove) {
                    const updatedParticipants = {};
                    Object.keys(participants).forEach(name => {
                        updatedParticipants[name] = participants[name].filter(dateKey => {
                            return !(dateKey >= rangeToRemove.startDate && dateKey <= rangeToRemove.endDate);
                        });
                    });
                    setParticipants(updatedParticipants);
                }
                
                await saveWorkshopConfig();
            };

            const confirmAvailability = async () => {
                if (participantName && participants[participantName]?.length > 0) {
                    setSaving(true);
                    
                    try {
                        const participantData = {
                            type: 'participant',
                            name: participantName,
                            selectedDates: participants[participantName]
                        };
                        
                        await saveToSheets(participantData);
                        
                        // Load fresh results data for thank you page
                        try {
                            const data = await loadFromSheets();
                            setResultsData({
                                dateRanges: data.config.dateRanges || [],
                                participants: data.participants || {}
                            });
                        } catch (error) {
                            console.error('Error loading results for thank you page:', error);
                        }
                        
                        switchToView('thank-you');
                    } catch (error) {
                        console.error('Save error:', error);
                        alert(`Error saving your response: ${error.message}`);
                    } finally {
                        setSaving(false);
                    }
                } else {
                    alert('Please enter your name and select at least one date before confirming.');
                }
            };

            // Helper functions for results
            const getDateParticipantCount = (dateKey, participantsData = participants) => {
                return Object.values(participantsData).filter(availability => 
                    availability.includes(dateKey)
                ).length;
            };

            const getAllSelectedDates = (rangesData = dateRanges, participantsData = participants) => {
                const allDates = new Set();
                rangesData.forEach(range => {
                    const start = new Date(range.startDate);
                    const end = new Date(range.endDate);
                    
                    for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                        allDates.add(formatDateKey(d));
                    }
                });
                
                return Array.from(allDates).sort().map(dateKey => ({
                    dateKey,
                    count: getDateParticipantCount(dateKey, participantsData),
                    displayDate: new Date(dateKey).toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })
                }));
            };

            const formatRangeDisplay = (range) => {
                const startDate = new Date(range.startDate);
                const endDate = new Date(range.endDate);
                
                if (range.startDate === range.endDate) {
                    return startDate.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                } else {
                    return `${startDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric' 
                    })} - ${endDate.toLocaleDateString('en-US', { 
                        month: 'short', 
                        day: 'numeric',
                        year: 'numeric' 
                    })}`;
                }
            };

            if (loading) {
                return (
                    <div className="max-w-6xl mx-auto p-6 bg-white min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
                            <p className="text-gray-600">Loading workshop data from Google Sheets...</p>
                        </div>
                    </div>
                );
            }

            if (currentView === 'thank-you') {
                const totalResultsParticipants = Object.keys(resultsData.participants).length;
                const sortedResultsDates = getAllSelectedDates(resultsData.dateRanges, resultsData.participants)
                    .filter(date => date.count > 0)
                    .sort((a, b) => b.count - a.count);

                return (
                    <div className="max-w-6xl mx-auto p-6 bg-white min-h-screen">
                        <div className="text-center mb-8">
                            <CheckCircle className="icon-3xl text-green-600 mx-auto mb-4" />
                            <h1 className="text-4xl font-bold text-gray-900 mb-2">Thank You!</h1>
                            <p className="text-xl text-gray-600 mb-6">Your availability has been saved successfully.</p>
                            
                            <div className="bg-green-50 border border-green-200 rounded-lg p-6 mb-6 max-w-md mx-auto">
                                <h3 className="font-semibold text-green-800 mb-2">What's Next?</h3>
                                <p className="text-green-700 text-sm">
                                    The workshop organizer will review all responses and announce the final dates soon. 
                                    Check out the current results below!
                                </p>
                            </div>
                        </div>

                        {totalResultsParticipants > 0 && sortedResultsDates.length > 0 ? (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                                {/* Results Analysis - Left/Center */}
                                <div className="lg:col-span-2">
                                    <div className="bg-white border border-gray-200 rounded-lg p-6">
                                        <div className="flex items-center gap-2 mb-4">
                                            <Users className="icon-lg text-blue-600" />
                                            <h3 className="text-xl font-semibold">Current Results</h3>
                                            <span className="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-medium">
                                                {totalResultsParticipants} vote{totalResultsParticipants !== 1 ? 's' : ''} so far
                                            </span>
                                        </div>
                                        
                                        <div className="space-y-4 max-h-96 overflow-y-auto">
                                            {sortedResultsDates.map((date, index) => {
                                                const percentage = totalResultsParticipants > 0 ? (date.count / totalResultsParticipants) * 100 : 0;
                                                const isWinner = index === 0 && date.count > 0;
                                                const rank = index + 1;
                                                
                                                return (
                                                    <div key={date.dateKey} className={`p-4 rounded-lg border-2 ${isWinner ? 'border-green-500 bg-green-50' : 'border-gray-200 bg-white'}`}>
                                                        <div className="flex items-center justify-between mb-2">
                                                            <div className="flex items-center gap-3">
                                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-white ${
                                                                    rank === 1 ? 'bg-yellow-500' : 
                                                                    rank === 2 ? 'bg-gray-400' : 
                                                                    rank === 3 ? 'bg-orange-400' : 'bg-gray-300'
                                                                }`}>
                                                                    {rank}
                                                                </div>
                                                                {isWinner && <CheckCircle className="icon-lg text-green-600" />}
                                                                <div>
                                                                    <div className={`font-semibold text-lg ${isWinner ? 'text-green-700' : 'text-gray-900'}`}>
                                                                        {date.displayDate}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div className="text-right">
                                                                <div className={`text-2xl font-bold ${isWinner ? 'text-green-600' : 'text-gray-900'}`}>
                                                                    {date.count}/{totalResultsParticipants}
                                                                </div>
                                                                <div className="text-sm text-gray-500">{Math.round(percentage)}% available</div>
                                                            </div>
                                                        </div>
                                                        
                                                        <div className="w-full bg-gray-200 rounded-full h-3">
                                                            <div 
                                                                className={`h-3 rounded-full ${
                                                                    rank === 1 ? 'bg-yellow-500' : 
                                                                    rank === 2 ? 'bg-gray-400' : 
                                                                    rank === 3 ? 'bg-orange-400' : 'bg-gray-300'
                                                                } ${isWinner ? 'bg-green-500' : ''}`}
                                                                style={{ width: `${percentage}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>

                                        {sortedResultsDates.length > 0 && (
                                            <div className="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
                                                <h4 className="font-semibold text-green-800 mb-2">
                                                    🏆 Current Winner{sortedResultsDates.filter((date, index) => index === 0 && date.count === sortedResultsDates[0]?.count).length > 1 ? 's' : ''}:
                                                </h4>
                                                <div className="space-y-1">
                                                    {sortedResultsDates
                                                        .filter(date => date.count === sortedResultsDates[0]?.count)
                                                        .map(date => (
                                                            <div key={date.dateKey} className="text-green-700 font-medium">
                                                                {date.displayDate}
                                                            </div>
                                                        ))}
                                                </div>
                                            </div>
                                        )}

                                        <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                                            <p className="text-sm text-blue-700">
                                                <strong>Note:</strong> Results update in real-time as more team members vote. 
                                                The final decision will be announced once everyone has responded.
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Luis the Cat - Right Side */}
                                <div className="lg:col-span-1">
                                    <div className="bg-white border border-gray-200 rounded-lg p-6 text-center">
                                        <h3 className="text-lg font-semibold mb-4 text-gray-900">Meet Luis! 🐱</h3>
                                        <div className="mb-4">
                                            <img 
                                                src="./Luis.jpg" 
                                                alt="Luis the cat" 
                                                className="w-full h-64 object-cover rounded-lg shadow-md"
                                                onError={(e) => {
                                                    e.target.style.display = 'none';
                                                    e.target.nextSibling.style.display = 'block';
                                                }}
                                            />
                                            <div className="hidden bg-gray-100 h-64 rounded-lg flex items-center justify-center">
                                                <div className="text-center text-gray-500">
                                                    <div className="text-4xl mb-2">🐱</div>
                                                    <p className="text-sm">Luis says thanks for voting!</p>
                                                </div>
                                            </div>
                                        </div>
                                        <p className="text-sm text-gray-600">
                                            Luis is keeping an eye on the voting results and purring with approval! 
                                            Thanks for participating in the workshop scheduling.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div className="text-center py-8 bg-gray-50 rounded-lg">
                                    <p className="text-gray-600">No results to display yet. More votes needed!</p>
                                </div>
                                <div className="bg-white border border-gray-200 rounded-lg p-6 text-center">
                                    <h3 className="text-lg font-semibold mb-4 text-gray-900">Meet Luis! 🐱</h3>
                                    <img 
                                        src="./Luis.jpg" 
                                        alt="Luis the cat" 
                                        className="w-full h-64 object-cover rounded-lg shadow-md"
                                        onError={(e) => {
                                            e.target.style.display = 'none';
                                            e.target.nextSibling.style.display = 'block';
                                        }}
                                    />
                                    <div className="hidden bg-gray-100 h-64 rounded-lg flex items-center justify-center">
                                        <div className="text-center text-gray-500">
                                            <div className="text-4xl mb-2">🐱</div>
                                            <p className="text-sm">Luis says thanks for voting!</p>
                                        </div>
                                    </div>
                                    <p className="text-sm text-gray-600 mt-4">
                                        Luis is waiting for more votes to come in!
                                    </p>
                                </div>
                            </div>
                        )}

                        <div className="text-center space-y-3 mt-8">
                            <button
                                onClick={() => switchToView('participant')}
                                className="block w-full max-w-sm mx-auto px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                            >
                                View/Edit My Response
                            </button>
                            
                            <button
                                onClick={() => switchToView('admin')}
                                className="block w-full max-w-sm mx-auto px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                            >
                                View Full Results (Admin)
                            </button>
                        </div>
                    </div>
                );
            }

            if (currentView === 'admin') {
                const totalParticipants = Object.keys(participants).length;
                const sortedDates = getAllSelectedDates().sort((a, b) => b.count - a.count);

                return (
                    <div className="max-w-6xl mx-auto p-6 bg-white">
                        {/* Confirmation Message */}
                        {showConfirmation && (
                            <div className="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2">
                                <CheckCircle className="icon" />
                                <span>Date range saved successfully!</span>
                            </div>
                        )}

                        <div className="flex items-center justify-between mb-6">
                            <div className="flex items-center gap-3">
                                <Calendar className="icon-xl text-blue-600" />
                                <h1 className="text-3xl font-bold text-gray-900">Workshop Scheduler</h1>
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={copyParticipantLink}
                                    className="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                                >
                                    <Link className="icon" />
                                    Copy Participant Link
                                </button>
                                <button
                                    onClick={() => switchToView('participant')}
                                    className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                                >
                                    <User className="icon" />
                                    Participant View
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Left Column - Calendar and Configuration */}
                            <div className="space-y-6">
                                <div className="bg-white border border-gray-200 rounded-lg p-6">
                                    <h3 className="text-lg font-semibold mb-4">Workshop Configuration</h3>
                                    <div className="mb-4">
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Workshop Description</label>
                                        <input
                                            type="text"
                                            placeholder="e.g., Sprint Planning Workshop"
                                            value={workshopDescription}
                                            onChange={(e) => setWorkshopDescription(e.target.value)}
                                            className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                        />
                                    </div>
                                    
                                    <div className="text-sm text-gray-600 mb-4">
                                        {selectionStart ? (
                                            <p className="text-blue-600 font-medium">
                                                📅 Click a second date to complete your selection
                                            </p>
                                        ) : (
                                            <p>
                                                Click dates on the calendar to select ranges. First click = start date, second click = end date.
                                            </p>
                                        )}
                                    </div>
                                </div>

                                <CalendarComponent
                                    dateRanges={dateRanges}
                                    onDateClick={handleAdminDateClick}
                                    isAdmin={true}
                                    participants={participants}
                                    selectionStart={selectionStart}
                                    highlightedRange={highlightedRange}
                                />
                            </div>

                            {/* Right Column - Selected Ranges and Results */}
                            <div className="space-y-6">
                                {dateRanges.length > 0 && (
                                    <div className="bg-white border border-gray-200 rounded-lg p-6">
                                        <h3 className="text-lg font-semibold mb-4">Selected Date Ranges</h3>
                                        <div className="space-y-3">
                                            {dateRanges.map((range) => (
                                                <div key={range.id} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                                    <div>
                                                        <div className="font-medium">{formatRangeDisplay(range)}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeRange(range.id)}
                                                        className="text-red-600 hover:text-red-800 p-1"
                                                    >
                                                        <Trash2 className="icon" />
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}

                                {totalParticipants > 0 && sortedDates.length > 0 && (
                                    <div className="bg-white border border-gray-200 rounded-lg p-6">
                                        <div className="flex items-center gap-2 mb-4">
                                            <Users className="icon-lg text-green-600" />
                                            <h3 className="text-lg font-semibold">Results ({totalParticipants} participants)</h3>
                                        </div>
                                        
                                        <div className="space-y-3 max-h-96 overflow-y-auto">
                                            {sortedDates.filter(date => date.count > 0).map((date, index) => {
                                                const percentage = totalParticipants > 0 ? (date.count / totalParticipants) * 100 : 0;
                                                const isWinner = index === 0 && date.count > 0;
                                                
                                                return (
                                                    <div key={date.dateKey} className={`p-3 rounded-lg border ${isWinner ? 'border-green-500 bg-green-50' : 'border-gray-200'}`}>
                                                        <div className="flex items-center justify-between mb-2">
                                                            <div className="flex items-center gap-2">
                                                                {isWinner && <CheckCircle className="icon text-green-600" />}
                                                                <div className="font-medium">{date.displayDate}</div>
                                                            </div>
                                                            <div className="text-right">
                                                                <div className="font-bold">{date.count}/{totalParticipants}</div>
                                                                <div className="text-sm text-gray-500">{Math.round(percentage)}%</div>
                                                            </div>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                                            <div 
                                                                className={`h-2 rounded-full ${isWinner ? 'bg-green-500' : 'bg-blue-500'}`}
                                                                style={{ width: `${percentage}%` }}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // Participant View
            return (
                <div className="max-w-6xl mx-auto p-6 bg-white">
                    <div className="flex items-center justify-between mb-6">
                        <div className="flex items-center gap-3">
                            <Users className="icon-xl text-green-600" />
                            <h1 className="text-3xl font-bold text-gray-900">Select Your Availability</h1>
                        </div>
                        <button
                            onClick={() => switchToView('admin')}
                            className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            <Settings className="icon" />
                            Admin View
                        </button>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        {/* Left Column - Participant Info and Calendar */}
                        <div className="space-y-6">
                            <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div className="mb-3">
                                    <label className="block text-sm font-medium text-green-900 mb-2">Your Name</label>
                                    <input
                                        type="text"
                                        placeholder="Enter your name"
                                        value={participantName}
                                        onChange={(e) => setParticipantName(e.target.value)}
                                        className="w-full max-w-sm px-3 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                    />
                                </div>
                                <p className="text-green-700 text-sm">
                                    Click on available dates in the calendar to select your availability. 
                                    Selected dates will turn green.
                                </p>
                            </div>

                            <CalendarComponent
                                dateRanges={dateRanges}
                                onDateClick={handleParticipantDateClick}
                                isAdmin={false}
                                participants={participants}
                            />
                        </div>

                        {/* Right Column - Selection Summary */}
                        <div className="space-y-6">
                            {participantName && participants[participantName]?.length > 0 && (
                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <h4 className="font-semibold text-blue-800 mb-3">Your Selected Dates:</h4>
                                    <div className="space-y-2 max-h-48 overflow-y-auto">
                                        {participants[participantName]
                                            .sort()
                                            .map(dateKey => {
                                                const date = new Date(dateKey);
                                                const displayDate = date.toLocaleDateString('en-US', { 
                                                    weekday: 'long', 
                                                    year: 'numeric', 
                                                    month: 'long', 
                                                    day: 'numeric' 
                                                });
                                                return (
                                                    <div key={dateKey} className="text-blue-700 text-sm">
                                                        ✓ {displayDate}
                                                    </div>
                                                );
                                            })}
                                    </div>
                                    
                                    <div className="mt-4">
                                        <button
                                            onClick={confirmAvailability}
                                            disabled={saving}
                                            className="w-full px-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                        >
                                            {saving ? (
                                                <>
                                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                                                    Saving...
                                                </>
                                            ) : (
                                                <>
                                                    <Save className="icon" />
                                                    Confirm My Availability
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>
                            )}

                            {dateRanges.length === 0 && (
                                <div className="text-center py-12 bg-gray-50 rounded-lg">
                                    <Calendar className="icon-3xl text-gray-400 mx-auto mb-4" />
                                    <h3 className="text-lg font-medium text-gray-900 mb-2">No Dates Available</h3>
                                    <p className="text-gray-600">The administrator hasn't selected any date ranges yet.</p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<WorkshopScheduler />, document.getElementById('root'));
    </script>
</body>
</html>
